package com.tfa7ss.myapplicationsdasa
import android.content.Context
import android.content.DialogInterface
import android.view.LayoutInflater
import android.view.View
import android.view.ViewGroup
import android.widget.ArrayAdapter
import androidx.appcompat.app.AlertDialog
import kotlinx.android.synthetic.main.item.view.*
class CustomAdabter(context: Context, private val objects: ArrayList<Items>) :
    ArrayAdapter<Items>(context, R.layout.item, objects) {

    lateinit var mydatabase: mydata
    override fun getView(position: Int, convertView: View?, parent: ViewGroup): View {
        mydatabase = mydata(context)
        val l: LayoutInflater = LayoutInflater.from(context)
        val customView: View = l.inflate(R.layout.item, parent, false)
        customView.textView3.text = getItem(position)!!.name
        customView.textView5.text = (getItem(position)!!.count * getItem(position)!!.price).toString()
        customView.imageButton.setOnClickListener {
            val builder = AlertDialog.Builder(context)
            builder.setTitle("حذف")
            builder.setMessage("هل تريد الحذف فعلا؟")
            builder.setPositiveButton("موافق") { _: DialogInterface, _: Int ->
                mydatabase.deleteProduct(getItem(position)!!.name)
                objects.removeAt(position)
                notifyDataSetChanged()
            }
            builder.setNeutralButton("لا") { _: DialogInterface, _: Int -> }
            builder.create().show()
        }
        return customView
    }
}






كود الCustomAdabter
---------------------------------------------------------------------









package com.tfa7ss.myapplicationsdasa
import android.content.Intent
import androidx.appcompat.app.AppCompatActivity
import android.os.Bundle
import kotlinx.android.synthetic.main.activity_main.*
class MainActivity : AppCompatActivity() {
    lateinit var mydatabase: mydata
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)
        mydatabase = mydata(this)
        printData(mydatabase.databaseToString())
        button3.setOnClickListener {
            printData(mydatabase.databaseToString())
        }
        button2.setOnClickListener {
            val item = mydatabase.findProduct(plantext1.text.toString())
            printData(item)
        }
        button4.setOnClickListener {
            startActivity(Intent(this, MainActivity2::class.java))
        }
    }
    override fun onResume() {
        super.onResume()
        printData(mydatabase.databaseToString())
    }
    fun printData(array: ArrayList<Items>) {
        val a = CustomAdabter(this, array)
        listview1.adapter = a
    }
}

كود الMainActivity








------------------------------------------------------------------------







package com.tfa7ss.myapplicationsdasa
import android.content.Intent
import androidx.appcompat.app.AppCompatActivity
import android.os.Bundle
import android.widget.Toast
import kotlinx.android.synthetic.main.activity_main2.*
class MainActivity2 : AppCompatActivity() {
    lateinit var mydatabase: mydata
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main2)
        mydatabase = mydata(this)
        button5.setOnClickListener {
            if (plantext2.text.isEmpty() || plantext3.text.isEmpty() || plantext4.text.isEmpty()) {
                Toast.makeText(this, "هناك قيم فارغة يجب إضافة جميع القيم.", Toast.LENGTH_LONG).show()
            } else {
                val name = plantext2.text.toString()
                val count = plantext3.text.toString().toInt()
                val price = plantext4.text.toString().toDouble()
                mydatabase.addProduct("NAME", name, "OUANTITY", count, "price", price)
                startActivity(Intent(this, MainActivity::class.java))
            }
        }
        button6.setOnClickListener {
            startActivity(Intent(this, MainActivity::class.java))
        }
    }
}




كود الMainActivity2




---------------------------------------------------------



package com.tfa7ss.myapplicationsdasa

import android.annotation.SuppressLint
import android.content.ContentValues
import android.content.Context
import android.database.Cursor
import android.database.sqlite.SQLiteDatabase
import android.database.sqlite.SQLiteOpenHelper
data class Items(var id: Int, var name: String, var count: Int, var price: Double)
class mydata(context: Context) : SQLiteOpenHelper(context, DATABASE_NAME, null, DATABASE_VERSION) {
    override fun onCreate(db: SQLiteDatabase) {
        db.execSQL(DATABASE_CREATE)
    }
    override fun onUpgrade(db: SQLiteDatabase, oldVersion: Int, newVersion: Int) {
        db.execSQL("DROP TABLE IF EXISTS $DATABASE_TABLE_NAME")
        onCreate(db)
    }
    companion object {
        const val item_id = "ID"
        const val item_neme = "NAME"
        const val item_count = "OUANTITY"
        const val item_price = "price"
        const val DATABASE_TABLE_NAME = "itemtbl"
        private const val DATABASE_NAME = "data.db"
        private const val DATABASE_VERSION = 2
        private const val DATABASE_CREATE =
            "CREATE TABLE $DATABASE_TABLE_NAME(" +
                    "$item_id INTEGER PRIMARY KEY AUTOINCREMENT," +
                    "$item_neme TEXT NOT NULL," +
                    "$item_count INTEGER," +
                    "$item_price REAL);"
    }
    @SuppressLint("Range")
    fun databaseToString(): ArrayList<Items> {
        val list = ArrayList<Items>()
        val db: SQLiteDatabase = this.readableDatabase
        val c: Cursor = db.rawQuery("select * from $DATABASE_TABLE_NAME where 1", null)
        if (c.moveToFirst()) {
            while (!c.isAfterLast) {
                val itemData = Items(
                    c.getInt(c.getColumnIndex(item_id)),
                    c.getString(c.getColumnIndex(item_neme)),
                    c.getInt(c.getColumnIndex(item_count)),
                    c.getDouble(c.getColumnIndex(item_price))
                )
                list.add(itemData)
                c.moveToNext()
            }
        }
        c.close()
        db.close()
        return list
    }
    fun addProduct(
        itemName: String,
        name: String,
        itemCount: String,
        count: Int,
        itemPrice: String,
        price: Double
    ) {
        val db: SQLiteDatabase = this.writableDatabase
        val values = ContentValues()
        values.put(itemName, name.trim())
        values.put(itemCount, count)
        values.put(itemPrice, price)
        db.insert(DATABASE_TABLE_NAME, null, values)
        db.close()
    }
    fun deleteProduct(itemName: String) {
        val db: SQLiteDatabase = this.writableDatabase
        db.delete(DATABASE_TABLE_NAME, "$item_neme = ?", arrayOf(itemName.trim()))
        db.close()
    }
    @SuppressLint("Range")
    fun findProduct(itemName: String): ArrayList<Items> {
        val list = ArrayList<Items>()
        val db: SQLiteDatabase = this.readableDatabase
        val c: Cursor = db.rawQuery(
            "select * from $DATABASE_TABLE_NAME where $item_neme = ?;",
            arrayOf(itemName.trim())
        )
        if (c.moveToFirst()) {
            while (!c.isAfterLast) {
                val itemData = Items(
                    c.getInt(c.getColumnIndex(item_id)),
                    c.getString(c.getColumnIndex(item_neme)),
                    c.getInt(c.getColumnIndex(item_count)),
                    c.getDouble(c.getColumnIndex(item_price))
                )
                list.add(itemData)
                c.moveToNext()
            }
        }
        c.close()
        db.close()
        return list
    }
}




كود الmydata


